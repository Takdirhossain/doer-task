<div class="common-datatable-wrapper">
  <div class="flex flex-space-between" *ngIf="showSearch || showLimit">
    <div *ngIf="showLimit" class="flex items-center gap-3">
      <select class="limit-option" [ngModel]="pageSize" (ngModelChange)="onPageSizeChange($event)">
        <option *ngFor="let size of pageSizeOptions" [value]="size">
          {{ size }}
        </option>
      </select>
    </div>

    <div *ngIf="showSearch" class="flex items-center search-input">
      <div class="relative w-64">
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Search..."
          class="search"
        />
      </div>
    </div>
  </div>

  <div *ngIf="!loading" class="table-container mt-4">
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 w-full">
        <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
          <th mat-header-cell *matHeaderCellDef [class]="column.class">
            {{ column.label }}
          </th>
          <td mat-cell *matCellDef="let row" [class]="column.class">
            {{ getCellValue(row, column) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions" *ngIf="config.showActions && config.actions">
          <th mat-header-cell *matHeaderCellDef class="w-32 text-center">Actions</th>
          <td mat-cell *matCellDef="let row" class="text-center">
            <button
              *ngFor="let action of config.actions"
              mat-icon-button
              [color]="action.color || 'primary'"
              [matTooltip]="action.tooltip"
              (click)="executeAction(action, row, $event)"
              [style.display]="shouldShowAction(action, row) ? 'inline-flex' : 'none'"
            >
              <mat-icon>{{ action.icon }}</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr
          mat-row
          *matRowDef="let row; let i = index; columns: displayedColumns"
          [ngClass]="{ 'even-row': i % 2 === 1 }"
        ></tr>
      </table>

      <div *ngIf="dataSource.data.length === 0" class="text-center py-8">
        <p class="text-gray-500">{{ noDataMessage }}</p>
      </div>
    </div>

    <mat-paginator
      *ngIf="totalRecords > 0"
      [length]="totalRecords"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      class="mt-3"
    ></mat-paginator>
  </div>

  <div *ngIf="loading" class="flex justify-center items-center py-10">
   <span class="loader"></span>
  </div>
</div>

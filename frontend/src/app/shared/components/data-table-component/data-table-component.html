<div class="common-datatable-wrapper">
  <div class="flex justify-between items-center mb-3" *ngIf="showSearch || showLimit">
    <div *ngIf="showLimit" class="flex items-center gap-3">
      <mat-form-field appearance="outline">
        <mat-label>Items per page</mat-label>
        <mat-select [value]="pageSize" (selectionChange)="onPageSizeChange($event.value)">
          <mat-option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div *ngIf="showSearch" class="flex items-center">
      <mat-form-field appearance="outline" class="w-64">
        <mat-label>Search</mat-label>
        <input
          matInput
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange($event)"
          placeholder="Search..."
        />
        <button
          *ngIf="searchTerm"
          matSuffix
          mat-icon-button
          aria-label="Clear"
          (click)="searchTerm=''; onSearchChange('')"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>
    </div>
  </div>

  <div *ngIf="!loading" class="table-container">
    <div class="overflow-x-auto">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 w-full">

        <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
          <th mat-header-cell *matHeaderCellDef [class]="column.class">
            {{ column.label }}
          </th>
          <td mat-cell *matCellDef="let row" [class]="column.class">
            {{ getCellValue(row, column) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="actions" *ngIf="config.showActions && config.actions">
          <th mat-header-cell *matHeaderCellDef class="w-32 text-center">Actions</th>
          <td mat-cell *matCellDef="let row" class="text-center">
            <button
              *ngFor="let action of config.actions"
              mat-icon-button
              [color]="action.color || 'primary'"
              [matTooltip]="action.tooltip"
              (click)="executeAction(action, row, $event)"
              [style.display]="shouldShowAction(action, row) ? 'inline-flex' : 'none'"
            >
              <mat-icon>{{ action.icon }}</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div *ngIf="dataSource.data.length === 0" class="text-center py-8">
        <p class="text-gray-500">{{ noDataMessage }}</p>
      </div>
    </div>

    <mat-paginator
      *ngIf="totalRecords > 0"
      [length]="totalRecords"
      [pageIndex]="pageIndex"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)"
      class="mt-3"
    ></mat-paginator>
  </div>

  <div *ngIf="loading" class="flex justify-center items-center py-10">
    <mat-spinner diameter="50"></mat-spinner>
  </div>
</div>
